# test-etl

### PHP
При разработке использовалась версия 8.3.1

### Composer
При разработке использовалась версия 2.6.6

### Docker
Проект был создан в docker окружении.
Находясь в одной директории с docker-compose.yml,
выполните в консоли:

docker-compose up -d 

docker-compose exec php83 composer require phpoffice/phpspreadsheet --working-dir=/data

docker-compose exec php83 composer require vlucas/phpdotenv --working-dir=/data

Корень проекта в docker-контейнире находиться в каталоге: /data;

После запуска докер-контейнера, необходимо настроить своё подключение в файле: /data/.env;

Далее, после настройки подключения к БД, необходимо выполнить на сервере dump.sql-файл, который находиться в: /data/handbook/dump.sql;

СТРУКТУРА ПАПОК
-------------------
      app/                само приложение, где находиться вся кодовая база
        common/           общие элементы проекта
        controllers/      http-контроллеры
        db/               подключение к базе данных
        models/           модели
      docker/             необходимые файлы для docker (php.ini, nginx.conf)
      files/              место хранение временных файлов, пока парситься xlsx-файл

host: localhost; <br />
port: 8222;

После предварительных настроек, можно приступать к работе с самим сервисом:

1) Для того что бы загрузить данные в БД, нужно сделать POST-запрос на эндпоинт - http://localhost:8222/; с праметром "file";
ответ при успешной загрузке:
...
ответ при возникновениии ошибки:
...

2) Что бы посмотреть список агенств(agency), по GET-запросу на эндпоинт - http://localhost:8222/agency/all; без параметров;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

3) Что бы узнать инфомацию по конкретному агенству(agency), по GET-запросу на эндпоинт - http://localhost:8222/agency/by-local-id?local_id=янв-1;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

4) Так же можно обратиться к конкретному агенству(agency) по уникальному id, по GET-запросу на эндпоинт - http://localhost:8222/agency/by-id?id=1
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

5) Что бы посмотреть список контактов с продавцами(contacts), по GET-запросу на эндпоинт - http://localhost:8222/contacts/all; без параметров;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

6) Что бы узнать контакт продавца(contacts), по GET-запросу на эндпоинт - http://localhost:8222/contacts/by-local-id?local_id=янв-1;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

7) А также можно выполнить этот запрос и по id(contacts), по GET-запросу на эндпоинт - http://localhost:8222/contacts/by-id?id=1;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...


Все остальные(manager, estate) GET-запросы, соответственно, аналогичные:
...


1) Посмотреть список всех объявений по недвижемости(all_view), по GET-запросу на эндпоинт - http://localhost:8222/estate/all-view; без параметров;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

9) Отфильтровать список объявлений по агенству(estate), по GET-запросу на эндпоинт - http://localhost:8222/estate/by-local-id-agancy?local_id=ух-1;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

10) Отфильтровать список объявлений по контактам продавца(estate), по GET-запросу на эндпоинт - http://localhost:8222/estate/by-contacts-id?contacts_id=1;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...

11) Отфильтровать список объявлений по manager_id(estate), по GET-запросу на эндпоинт - http://localhost:8222/estate/by-manager-id?manager_id=1;
ответ при успешной обработке запроса:
...
ответ при возникновениии ошибки:
...